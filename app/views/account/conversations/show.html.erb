<div id="conversation">

  <header>
    <%= resource.negotiator_for(current_user).name %>
  </header>

  <div class="content">
    <div id="messages">
      <% resource.messages.includes(:sender).each do |message| %>
        <%= render 'account/conversations/message', message: message %>
      <% end %>
    </div>

    <div class="message new-message">
      <div class="photo">
        <%= image_tag current_user.avatar.url(:thumb), class: "avatar" %>
      </div>
      <div class="body">
        <%= simple_form_for @message, url: account_messages_path, data: {remote: true} do |f| %>
          <%= render "/account/messages/form", f: f %>
        <% end %>
      </div>
    </div>
  </div>

  <% if (deal = resource.deals.last).present? %>
    <aside id="deal-teaser" data-container="deal">
      <%= render "account/deals/#{deal.state}", deal: deal %>
    </aside>
  <% end %>

</div>
