<% @meta_title = "#{resource.name} artists profile on Sidestage.com" %>
<% @meta_desc = "Book #{resource.name} for your next party on Sidestage.com" %>
<% @social_img = resource.user.avatar_url(:thumb) %>
<% @social_desc = "Book #{resource.name} for your next party on Sidestage.com" %>

<div id="artist">

  <div class="content">
    <div class="infos">
      <div class="share-btn like-btn">
        <%= link_to "<i class='fa fa-facebook-square'></i>Share".html_safe, facebook_share_url(artist_url(resource)), target: :_blank, style: "color:#3b5998;", onclick: "window.open(this.href, 'mywin', 'left=400,top=200,width=514,height=300,toolbar=1,resizable=0'); return false;" %>
      </div>

      <div class="share-btn tweet-btn">
        <%= link_to "<i class='fa fa-twitter'></i>Tweet".html_safe, twitter_share_url("Check out #{resource.name} on Sidestage via @sidestagehq#{resource.twitter.present? ? " @#{resource.twitter}" : ''}", artist_url(resource)), target: :_blank, style: "color:#4099ff;" %>
      </div>
      <div class="share-btn gplus-btn">
        <%= link_to "<i class='fa fa-google-plus'></i>1".html_safe, googleplus_share_url(artist_url(resource)), target: :_blank, style: "color:#d34836;font-weight:300;", onclick: "window.open(this.href, 'mywin', 'left=400,top=200,width=514,height=429,toolbar=1,resizable=0'); return false;" %>
        <img itemprop="image" src="<%= resource.user.avatar_url(:thumb) %>" style="display:none;" />
      </div>
      <div class="share-btn pin-btn">
        <%= link_to "<i class='fa fa-pinterest'></i>Pin it".html_safe, pinterist_share_url(artist_url(resource), resource.user.avatar_url(:thumb)), target: :_blank, style: "color:#cb2027;display:none;", onclick: "window.open(this.href, 'mywin', 'left=350,top=200,width=750,height=316,toolbar=1,resizable=0'); return false;" %>
      </div>    
     </div> 

    <h2><%= resource.name %></h2>
    <p class="title"><%= resource.title %></p>

    <div class="about">
      <div class="truncate">
        <%= read_more_link(resource.about, 490) %>
      </div>
      <div class="fulltext" style="display:none;">
        <%= read_less_link(resource.about) %>
      </div>
    </div>

    <%= render 'media_types' %>
    
    <div data-container="reviews" class="reviews">
      <h4><%= Review.model_name.human(count: 2) %></h4>

      <% if current_user && current_user.id != resource.user_id %>
        <%= link_to t(:"application.artists.show.leave_a_review"), new_account_profile_review_path(resource), class: "light link-to-new-review", data: { lightbox: :html, target: "[data-container='new-review']" } %>
      <% else %>
        <%= link_to t(:"application.artists.show.leave_a_review"), new_user_registration_path, class: "light link-to-new-review" %>
      <% end %>
      
      <div style="display:none;" data-container="new-review">
          <div class="devise-lightbox new-review">
            <h3><%= t(:"application.reviews.new.title") %> <%= resource.name %></h3>
            <%= render "account/reviews/form", parent: resource, resource: Review.new %>
          </div>
          <script>
            jQuery(document).ready(function(){
                $('.star-rating-editable').starRating()
            })
          </script>     
      </div>          
      
      <% if resource.reviews.count > 0 %>
        <%= render partial: "account/reviews/review", collection: resource.reviews %>
      <% else %>
        <p><%= t(:"application.artists.show.no_reviews") %></p>
      <% end %>

    </div>

    <% if defined?(next_resource) && next_resource(true).present? %>
        <div class="next-artist right">
          <%= link_to artist_path(next_resource) do %>
              <%= t(:"application.artists.show.view_next") %> <i class='fa fa-angle-right'></i>
          <% end %>
        </div>
    <% end %>
    
  </div>

  <aside>
    <div class="booking-teaser" data-container="deal">
      <div class="photo">
        <%= image_tag resource.user.avatar_url(:thumb), alt: resource.user.full_name %>
      </div>
      <div class="name"><%= resource.name %></div>
      <div class="label"><%= resource.location %></div>
  
      <%# TODO: Provide Helper to render price & currency properly %>
      <div class="price"><%= artist_price(resource) %></div>
  
      <% if artist_contactable?(resource.user) %>
          <%= simple_form_for :deal, url: double_check_account_deals_path, remote: true, html: { id: 'quick-deal-request' } do |f| %>
  	          <%= f.input :profile_id, as: :hidden, input_html: { value: resource.id } %>
              <div class="date">
	              <%= f.input :start_at, as: :string, input_html: { class: "date-picker" }, label: false %>
                  <i class="fa fa-calendar"></i>
              </div>
                  
              <% if current_user %>
                  <% if (pending_deal = current_user.pending_deal_with_profile(resource)).present? %>
                      <%= link_to t(:"helpers.submit.deal.submit"), "" , class: "btn", data: { lightbox: :html, target: "[data-container='pending-deal']" } %>
                      <div style="display:none;" data-container="pending-deal">
                          <%= render "account/deals/customer_pending_deal", deal: pending_deal %>
                      </div>
                  <% else %>
                      <%= f.submit class: "btn" %>
                  <% end %>
              <% else %>
                  <%= link_to t(:"helpers.submit.deal.submit"), new_user_registration_path, class: "btn" %>
              <% end %>
          <% end %>
      <% end %>

      <% if artist_contactable?(resource.user)  %>
        <%= link_to t(:"application.artists.show.message_artist"), link_or_signin(new_account_message_path(receiver_id: resource.user.id, format: :html)), data: { lightbox: "ajax" }, class: "btn btn-white" %>
      <% end %>
    </div>

    <%= render "account/profiles/verifications", user: resource.user %>

  </aside>  

</div>