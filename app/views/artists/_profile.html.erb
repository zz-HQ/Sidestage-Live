<%= content_for :social_desc, "Check out my Sidestage profile. You can book me to play music at your event" %>

<div id="artist">

  <div class="content">
    
    <div class="infos">
      <div class="tweet-btn">
        <a href="https://twitter.com/share" class="twitter-share-button" data-size="small" data-text="Check out <%= resource.name %> on Sidestage" data-via="sidestagehq" data-count="none">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </div>

      <div class="like-btn">
        <div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button" data-action="like" data-show-faces="false" data-share="false"></div>
      </div>

      
      <!-- 
      <span><i class="fa fa-tag"></i> <%#= resource.genres.map(&:name).join(", ") %></span>
      <span><i class="fa fa-map-marker"></i> <%= resource.location %></span>
      <span><i class="fa fa-comment-o"></i> <%= resource.reviews.count %></span>
      -->
    </div> 
    
    <h2><%= resource.name %></h2>
    <p class="title"><%= resource.title %></p>

    <div class="about">
      <p><%= simple_format (strip_tags resource.about) %></p>
    </div>
    
    <nav class="tabs" data-id="social">
      <%- if resource.has_soundcloud? -%>
      <div class="tab-switch">SoundCloud</div>
      <%- end -%>
      <%- if resource.has_youtube? -%>
      <div class="tab-switch">Youtube</div>
      <%- end -%>
      <% if resource.has_pictures? %>
      <div class="tab-switch">Photos</div>
      <% end %>
    </nav>

    <div class="tabs" data-id="social">
      <%- if resource.has_soundcloud? -%>
      <div class="tab">
        <%# TODO: Load Soundcloud async if possible %>
        <%= soundcloud_widget %>
      </div>
      <%- end -%>
      <% if resource.has_youtube? %>
      <div class="tab">
        <%# TODO: Load Youtube async if possible %>
        <%= youtube_widget %>
      </div>
      <%- end -%>

      <% if resource.has_pictures? %>
      <div class="tab">
        <div class="picture-viewer">
          <div class="thumbs">
            <%- resource.pictures.each do |pic| -%>
              <div class="thumb" data-big-picture="<%= pic.picture.url(:preview) %>">
                <%= image_tag pic.picture.url(:thumb) %>
              </div>
            <%- end -%>
          </div>
          <div class="picture">
            <img>
          </div>
        </div>
      </div>
      <% end %>
    </div>
    
    <div data-container="reviews" class="reviews">
      <h4><%= Review.model_name.human(count: 2) %></h4>

      <% if current_user && current_user.id != resource.user_id %>
        <%= link_to t(:"application.artists.show.leave_a_review"), new_account_profile_review_path(resource), class: "light link-to-new-review", data: { lightbox: :html, target: "[data-container='new-review']" } %>
      <% end %>
      
      <div style="display:none;" data-container="new-review">
          <div class="devise-lightbox new-review">
            <h3><%= t(:"application.reviews.new.title") %> <%= resource.name %></h3>
            <%= render "account/reviews/form", parent: resource %>
          </div>
          <script>
            jQuery(document).ready(function(){
                $('.star-rating-editable').starRating()                
            })
          </script>     
      </div>          
      
      <% if resource.reviews.count > 0 %>
        <%= render partial: "account/reviews/review", collection: resource.reviews %>
      <% else %>
        <p><%= t(:"application.artists.show.no_reviews") %></p>
      <% end %>

    </div>

    <% if defined?(next_resource) && next_resource(true).present? %>
        <div class="next-artist right">
          <%= link_to artist_path(next_resource, params.except(:id)) do %>
              <%= t(:"application.artists.show.view_next") %> <i class='fa fa-angle-right'></i>
          <% end %>
        </div>
    <% end %>
    
  </div>

  <aside>

    <%# TODO: Finish Aside %>
    <div class="booking-teaser" data-container="deal">
      <div class="photo">
        <%= image_tag resource.user.avatar_url(:thumb) %>
      </div>
      <div class="name">
        <%= resource.name %>
      </div>
      <div class="label"><%= resource.location %></div>
  
      <%# TODO: Provide Helper to render price & currency properly %>
      <div class="price">
        <%= artist_price(resource) %>
      </div>
  
      <% if artist_contactable?(resource.user) %>
          <%= simple_form_for :deal, url: account_deals_path, remote: true, html: { id: 'quick-deal-request' } do |f| %>
  	          <%= f.input :profile_id, as: :hidden, input_html: { value: resource.id } %>
              <div class="date">
	              <%= f.input :start_at, as: :string, input_html: { class: "date-picker" }, label: false %>
                  <i class="fa fa-calendar"></i>
              </div>
  
              <div class="button">
                <% if current_user %>
                    <%= f.submit class: "btn btn-submit" %>
                <% else %>
                    <%= link_to t(:"helpers.submit.deal.submit"), new_user_session_path(return_to: request.url, format: :html), class: "btn btn-submit", data: { lightbox: "ajax" } %>
                <% end %>
              </div>
          <% end %>
      <% end %>

      <% if artist_contactable?(resource.user)  %>
        <div class="label message-artist">
          <%= link_to t(:"application.artists.show.message_artist"), link_or_signin(new_account_message_path(receiver_id: resource.user.id, format: :html)), data: { lightbox: "ajax" } %>
        </div>
      <% end %>
    </div>

  </aside>  

</div>